from django.contrib.auth import get_user_model
from rest_framework import permissions
from rest_framework.generics import CreateAPIView
from rest_framework.response import Response
from rest_framework.views import APIView

from binary_exploits.serializers import UserFullSerializer, UserSerializer


class UsersListFull(APIView):
    """
    List of users with full data - requires admin.
    """
    permission_classes = [permissions.IsAuthenticated, permissions.IsAdminUser]

    def get(self, request, format=None):
        users = get_user_model().objects.all().order_by('-date_joined')
        serializer = UserFullSerializer(users, many=True, context={'request': request})
        return Response(serializer.data)

class Register(CreateAPIView):
    """
    Register user
    """
    permission_classes = [
        permissions.AllowAny
    ]
    model = get_user_model()
    serializer_class = UserSerializer


class MeView(APIView):
    """
    Get basic user data about self.
    """
    permission_classes = [permissions.IsAuthenticated, permissions.IsAdminUser]

    def get(self, request, format=None):
        content = {
            **UserSerializer(request.user).data,
            'token': str(request.auth),
        }
        return Response(content)
